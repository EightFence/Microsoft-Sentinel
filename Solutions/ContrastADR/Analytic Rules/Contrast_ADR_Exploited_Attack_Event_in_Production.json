{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "Parameters": {
    "Workspace": {
      "type": "string"
    }
  },
  "resources": [
    {
      "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/31417149-f3a2-4db4-9e5f-85e0a464f6a1')]",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/31417149-f3a2-4db4-9e5f-85e0a464f6a1')]",
      "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
      "kind": "Scheduled",
      "apiVersion": "2021-03-01-preview",
      "properties": {
        "alertDetailsOverride": {
          "alertDisplayNameFormat": "{{result_s}} {{rule_s}} from {{SourceIP}} in Production",
          "alertDescriptionFormat": "{{result_s}}  on {{request_headers_referer_s}}  endpoint of {{application_name_s}} "
        },
        "tactics": [
          "InitialAccess",
          "Execution",
          "DefenseEvasion",
          "LateralMovement",
          "CommandAndControl"
        ],
        "name": "Contrast ADR - Exploited Attack in Production",
        "status": "Available",
        "triggerOperator": "gt",
        "queryFrequency": "5m",
        "eventGroupingSettings": {
          "aggregationKind": "AlertPerResult"
        },
        "query": "ContrastADR_CL\n| where result_s =~ \"exploited\" and environment_s =~ \"production\"\n",
        "description": "'Detects successful exploitation of security vulnerabilities in production environments as identified by Contrast ADR. This rule triggers on confirmed exploited attacks in production systems, requiring immediate incident response and remediation.'\n",
        "queryPeriod": "5m",
        "severity": "High",
        "triggerThreshold": 0,
        "incidentConfiguration": {
          "groupingConfiguration": {
            "groupByEntities": [
              "IP",
              "Host"
            ],
            "enabled": true,
            "reopenClosedIncident": false,
            "matchingMethod": "Selected",
            "lookbackDuration": "PT30M"
          },
          "createIncident": true
        },
        "entityMappings": [
          {
            "fieldMappings": [
              {
                "identifier": "Address",
                "columnName": "SourceIP"
              }
            ],
            "entityType": "IP"
          },
          {
            "fieldMappings": [
              {
                "identifier": "HostName",
                "columnName": "host_hostname_s"
              }
            ],
            "entityType": "Host"
          }
        ]
      }
    }
  ]
}
