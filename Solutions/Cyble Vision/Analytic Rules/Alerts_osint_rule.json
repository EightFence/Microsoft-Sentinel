{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "Parameters": {
    "Workspace": {
      "type": "string"
    }
  },
  "resources": [
    {
      "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/9ff985d8-57a8-4302-a8e6-34fa96c3c505')]",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/9ff985d8-57a8-4302-a8e6-34fa96c3c505')]",
      "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
      "kind": "Scheduled",
      "apiVersion": "2021-03-01-preview",
      "properties": {
        "triggerThreshold": 0,
        "triggerOperator": "GreaterThan",
        "enabled": true,
        "entityMappings": [
          {
            "entityType": "DNS",
            "fieldMappings": [
              {
                "columnName": "MA_Domain",
                "identifier": "DomainName"
              }
            ]
          },
          {
            "entityType": "URL",
            "fieldMappings": [
              {
                "columnName": "MA_DomainURL",
                "identifier": "Url"
              }
            ]
          },
          {
            "entityType": "Account",
            "fieldMappings": [
              {
                "columnName": "KeywordName",
                "identifier": "Name"
              }
            ]
          },
          {
            "entityType": "Host",
            "fieldMappings": [
              {
                "columnName": "Domain",
                "identifier": "HostName"
              }
            ]
          }
        ],
        "query": "Alerts_osint  \n| where Service == \"osint\" \n| extend MappedSeverity = Severity\n",
        "tactics": [
          "Reconnaissance",
          "ResourceDevelopment"
        ],
        "queryfrequency": "30m",
        "incidentConfiguration": {
          "alertDetailsOverride": null,
          "groupingConfiguration": {
            "matchingMethod": "AllEntities",
            "enabled": false,
            "reopenClosedIncident": false,
            "lookbackDuration": "PT5H"
          },
          "alertDescriptionFormat": "A public OSINT mention referencing monitored keyword/entity {{KeywordName}} has been detected. Source {{OS_Source}}. Mention URL {{OS_MentionURL}}. This may indicate reputational impact, data exposure, or adversarial research targeting the organization.\n",
          "createIncident": true,
          "alertDisplayNameFormat": "OSINT Mention Identified for Monitored Keyword {{KeywordName}}"
        },
        "name": "Cyble Vision Alerts OSINT Mention Detected",
        "description": "'Triggers when Cyble detects an OSINT mention related to monitored keywords, entities, or brand identifiers. OSINT findings may indicate data leaks, expose content, targeting activity, impersonation, or discussions that may require investigation.'\n",
        "customDetails": {
          "MentionDate": "OS_MentionDate",
          "MappedSeverity": "Severity",
          "PostSnippet": "OS_PostSnippet",
          "Service": "Service",
          "MentionURL": "OS_MentionURL",
          "Source": "OS_Source",
          "AlertID": "AlertID",
          "Status": "Status",
          "AuthorUsername": "OS_AuthorUsername",
          "AuthorName": "OS_AuthorName"
        },
        "eventGroupingSettings": {
          "aggregationKind": "AlertPerResult"
        },
        "severity": "Low",
        "queryPeriod": "30m",
        "status": "Available"
      }
    }
  ]
}
