{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "Parameters": {
    "Workspace": {
      "type": "string"
    }
  },
  "resources": [
    {
      "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/e52f36dd-7d4f-4aa8-a095-3b6fa2b28b8d')]",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/e52f36dd-7d4f-4aa8-a095-3b6fa2b28b8d')]",
      "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
      "kind": "Scheduled",
      "apiVersion": "2021-03-01-preview",
      "properties": {
        "severity": "Low",
        "entityMappings": null,
        "description": "'A newly detected CVE has been associated with a monitored keyword or asset. This may indicate exposure to newly published or exploited vulnerabilities.'\n",
        "customDetails": {
          "Service": "Service",
          "MappedSeverity": "Severity",
          "NV_CVE": "NV_CVE",
          "AlertID": "AlertID",
          "Status": "Status"
        },
        "name": "Cyble Vision Alerts New Vulnerability Detected",
        "status": "Available",
        "triggerOperator": "GreaterThan",
        "incidentConfiguration": {
          "groupingConfiguration": {
            "matchingMethod": "AllEntities",
            "lookbackDuration": "PT5H",
            "enabled": false,
            "reopenClosedIncident": false
          },
          "alertDisplayNameFormat": "New Vulnerability Identified {{NV_CVE}}",
          "severityColumnName": "MappedSeverity",
          "description": "A new vulnerability ({{NV_CVE}}) has been identified for one of the monitored keywords or assets. This CVE may pose risks depending on exposure and exploitability. Review CVE details and assess potential impact on your environment.\n",
          "createIncident": true,
          "alertDetailsOverride": null
        },
        "eventGroupingSettings": {
          "aggregationKind": "AlertPerResult"
        },
        "queryfrequency": "30m",
        "query": "Alerts_new_vulnerability  \n| where Service == \"new_vulnerability\" \n| extend MappedSeverity = Severity\n",
        "queryPeriod": "30m",
        "enabled": true,
        "triggerThreshold": 0,
        "tactics": [
          "InitialAccess"
        ]
      }
    }
  ]
}
