{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "Parameters": {
    "Workspace": {
      "type": "string"
    }
  },
  "resources": [
    {
      "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/22f49d67-7da7-4809-8d07-89e4478aa6b0')]",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/22f49d67-7da7-4809-8d07-89e4478aa6b0')]",
      "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
      "kind": "Scheduled",
      "apiVersion": "2021-03-01-preview",
      "properties": {
        "severity": "High",
        "status": "Available",
        "triggerThreshold": 0,
        "customDetails": {
          "SourceSype": "SourceSype",
          "AssetType": "AssetType",
          "RiskScore": "RiskScore",
          "FirstSeen": "FirstSeen",
          "AlertUID": "AlertUID",
          "TimeGenerated": "TimeGenerated",
          "Recommendation": "Recommendation",
          "UID": "UID",
          "Description": "Description",
          "Impact": "Impact",
          "LastSeen": "LastSeen",
          "AssetValue": "AssetValue"
        },
        "eventGroupingSettings": {
          "aggregationKind": "AlertPerResult"
        },
        "description": "\"Detects high-severity alerts related to impersonation of official social media handles associated with your brand. \nThese spoofed accounts may be used for phishing, disinformation, or fraud campaigns, posing significant reputational and security risks.\"\n",
        "incidentConfiguration": {
          "createIncident": true,
          "groupingConfiguration": {
            "enabled": false,
            "reopenClosedIncident": false,
            "matchingMethod": "AllEntities",
            "lookbackDuration": "PT5H"
          }
        },
        "queryFrequency": "5m",
        "query": "// High severity - Social Media Handle Impersonation\nlet timeFrame = 5m;\nCyfirmaBISocialHandlersAlerts_CL \n  | where severity == 'Critical' and TimeGenerated between (ago(timeFrame) .. now())\n  | extend\n      Description=description,\n      FirstSeen=first_seen,\n      LastSeen=last_seen,\n      RiskScore=risk_score,\n      AlertUID=alert_uid,\n      UID=uid,\n      AssetType=asset_type,\n      AssetValue=asset_value,\n      Impact=impact,\n      Recommendation=recommendation,\n      SourceSype=source_type,\n      ProviderName=\"CYFIRMA\",\n      ProductName=\"DeCYFIR/DeTCT\"\n  | project \n      TimeGenerated,\n      Description,\n      RiskScore,\n      FirstSeen,\n      LastSeen,\n      AlertUID,\n      UID,\n      AssetType,\n      AssetValue,\n      Impact,\n      Recommendation,\n      SourceSype,\n      ProductName,\n      ProviderName\n",
        "triggerOperator": "gt",
        "tactics": [
          "Reconnaissance",
          "ResourceDevelopment",
          "InitialAccess"
        ],
        "alertDetailsOverride": {
          "alertDescriptionFormat": "{{Description}} ",
          "alertDisplayNameFormat": "CYFIRMA - High Severity Social Media Handle Impersonation Detected - {{AssetType}}  :  {{AssetValue}} ",
          "alertDynamicProperties": [
            {
              "value": "ProductName",
              "alertProperty": "ProductName"
            },
            {
              "value": "ProviderName",
              "alertProperty": "ProviderName"
            }
          ]
        },
        "queryPeriod": "5m",
        "name": "CYFIRMA - Brand Intelligence - Social Media Handle Impersonation Detected High Rule"
      }
    }
  ]
}
