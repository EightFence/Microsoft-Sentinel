{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "Parameters": {
    "Workspace": {
      "type": "string"
    }
  },
  "resources": [
    {
      "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/8f97ddbe-ab66-4f6c-b675-73b5eeb07259')]",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/8f97ddbe-ab66-4f6c-b675-73b5eeb07259')]",
      "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
      "kind": "Scheduled",
      "apiVersion": "2021-03-01-preview",
      "properties": {
        "triggerThreshold": 0,
        "severity": "Medium",
        "customDetails": {
          "RiskScore": "RiskScore",
          "Domain": "Domain",
          "CreatedDate": "CreatedDate",
          "Description": "Description",
          "ThreatActor": "ThreatActor",
          "DRSubDomain": "DRSubDomain",
          "HostProvider": "HostProvider",
          "AlertUID": "AlertUID",
          "TimeGenerated": "TimeGenerated",
          "LastSeen": "LastSeen",
          "DomainSquat": "DomainSquat",
          "FirstSeen": "FirstSeen",
          "RegisteredDate": "RegisteredDate",
          "DRDomain": "DRDomain",
          "UID": "UID"
        },
        "queryPeriod": "5m",
        "queryFrequency": "5m",
        "description": "\"This analytics rule detects high-risk domain impersonation activity, where newly registered or existing domains closely resemble the legitimate brand name or organizational assets. \nThese suspicious domains may use typosquatting, homoglyphs, or brand keywords to mislead users, steal credentials, or host phishing/malicious content. \nThe domains are identified through CYFIRMA's external threat intelligence feeds and flagged due to potential misuse in impersonation, fraud, or social engineering attacks targeting employees, customers, or partners. \nEarly detection of these domains enables proactive mitigation measures such as domain takedown, DNS blocking, and awareness campaigns.\"\n",
        "triggerOperator": "gt",
        "tactics": [
          "ResourceDevelopment",
          "InitialAccess",
          "CommandAndControl"
        ],
        "alertDetailsOverride": {
          "alertDescriptionFormat": "{{Description}} ",
          "alertDynamicProperties": [
            {
              "value": "ProductName",
              "alertProperty": "ProductName"
            },
            {
              "value": "ProviderName",
              "alertProperty": "ProviderName"
            }
          ],
          "alertDisplayNameFormat": "CYFIRMA - Medium Severity Alert - Malicious Domain Impersonation of Corporate Brand - Domain Squat: {{DomainSquat}} "
        },
        "name": "CYFIRMA - Brand Intelligence - Domain Impersonation Medium Rule",
        "status": "Available",
        "query": "// Medium severity Brand Intelligence - Domain Impersonation\nlet timeFrame = 5m;\nCyfirmaBIDomainITAssetAlerts_CL\n| where severity == 'High' and TimeGenerated between (ago(timeFrame) .. now())\n| extend\n    Description=description,\n    FirstSeen=first_seen,\n    LastSeen=last_seen,\n    RiskScore=risk_score,\n    AlertUID=alert_uid,\n    UID=uid,\n    Domain=domain,\n    DRDomain=dr_domain,\n    DRSubDomain=dr_sub_domain,\n    DomainSquat=signature,\n    HostProvider=host_provider,\n    RegisteredDate=registered_date,\n    CreatedDate=created_date,\n    ThreatActor=suspected_threat_actor,\n    ProviderName='CYFIRMA',\n    ProductName='DeCYFIR/DeTCT'\n| project\n    TimeGenerated,\n    Description,\n    RiskScore,\n    FirstSeen,\n    LastSeen,\n    AlertUID,\n    UID,\n    Domain,\n    DRDomain,\n    DRSubDomain,\n    DomainSquat,\n    HostProvider,\n    RegisteredDate,\n    CreatedDate,\n    ThreatActor,\n    ProductName,\n    ProviderName\n",
        "eventGroupingSettings": {
          "aggregationKind": "AlertPerResult"
        },
        "entityMappings": [
          {
            "entityType": "DNS",
            "fieldMappings": [
              {
                "columnName": "Domain",
                "identifier": "DomainName"
              }
            ]
          },
          {
            "entityType": "DNS",
            "fieldMappings": [
              {
                "columnName": "DomainSquat",
                "identifier": "DomainName"
              }
            ]
          }
        ],
        "incidentConfiguration": {
          "createIncident": true,
          "groupingConfiguration": {
            "reopenClosedIncident": false,
            "lookbackDuration": "5h",
            "matchingMethod": "AllEntities",
            "enabled": false
          }
        }
      }
    }
  ]
}
