{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "Parameters": {
    "Workspace": {
      "type": "string"
    }
  },
  "resources": [
    {
      "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/710f4755-490d-4fa7-aef0-43b5a66edc7b')]",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/710f4755-490d-4fa7-aef0-43b5a66edc7b')]",
      "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
      "kind": "Scheduled",
      "apiVersion": "2021-03-01-preview",
      "properties": {
        "queryPeriod": "5m",
        "severity": "Medium",
        "queryFrequency": "5m",
        "incidentConfiguration": {
          "createIncident": true,
          "groupingConfiguration": {
            "lookbackDuration": "5h",
            "matchingMethod": "AllEntities",
            "enabled": false,
            "reopenClosedIncident": false
          }
        },
        "triggerOperator": "gt",
        "eventGroupingSettings": {
          "aggregationKind": "AlertPerResult"
        },
        "tactics": [
          "Reconnaissance",
          "ResourceDevelopment",
          "InitialAccess"
        ],
        "query": "// Medium severity - Social Media Handle Impersonation\nlet timeFrame = 5m;\nCyfirmaBISocialHandlersAlerts_CL \n  | where severity == 'High' and TimeGenerated between (ago(timeFrame) .. now())\n  | extend\n      Description=description,\n      FirstSeen=first_seen,\n      LastSeen=last_seen,\n      RiskScore=risk_score,\n      AlertUID=alert_uid,\n      UID=uid,\n      AssetType=asset_type,\n      AssetValue=asset_value,\n      Impact=impact,\n      Recommendation=recommendation,\n      SourceSype=source_type,\n      ProviderName=\"CYFIRMA\",\n      ProductName=\"DeCYFIR/DeTCT\"\n  | project \n      TimeGenerated,\n      Description,\n      RiskScore,\n      FirstSeen,\n      LastSeen,\n      AlertUID,\n      UID,\n      AssetType,\n      AssetValue,\n      Impact,\n      Recommendation,\n      SourceSype,\n      ProductName,\n      ProviderName\n",
        "alertDetailsOverride": {
          "alertDescriptionFormat": "{{Description}} ",
          "alertDynamicProperties": [
            {
              "value": "ProductName",
              "alertProperty": "ProductName"
            },
            {
              "value": "ProviderName",
              "alertProperty": "ProviderName"
            }
          ],
          "alertDisplayNameFormat": "CYFIRMA - Medium Severity Social Media Handle Impersonation Detected - {{AssetType}}  :  {{AssetValue}} "
        },
        "name": "CYFIRMA - Brand Intelligence - Social Media Handle Impersonation Detected Medium Rule",
        "customDetails": {
          "AssetType": "AssetType",
          "Impact": "Impact",
          "AssetValue": "AssetValue",
          "AlertUID": "AlertUID",
          "TimeGenerated": "TimeGenerated",
          "SourceSype": "SourceSype",
          "UID": "UID",
          "Description": "Description",
          "Recommendation": "Recommendation",
          "LastSeen": "LastSeen",
          "RiskScore": "RiskScore",
          "FirstSeen": "FirstSeen"
        },
        "triggerThreshold": 0,
        "description": "\"Detects high-severity alerts related to impersonation of official social media handles associated with your brand. \nThese spoofed accounts may be used for phishing, disinformation, or fraud campaigns, posing significant reputational and security risks.\"\n",
        "status": "Available"
      }
    }
  ]
}
