{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "Parameters": {
    "Workspace": {
      "type": "string"
    }
  },
  "resources": [
    {
      "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/28e315a3-725d-4261-a6c2-e597d51541f4')]",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/28e315a3-725d-4261-a6c2-e597d51541f4')]",
      "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
      "kind": "Scheduled",
      "apiVersion": "2021-03-01-preview",
      "properties": {
        "name": "CYFIRMA - Social and Public Exposure - Source Code Exposure on Public Repositories Rule",
        "status": "Available",
        "incidentConfiguration": {
          "groupingConfiguration": {
            "enabled": false,
            "matchingMethod": "AllEntities",
            "lookbackDuration": "PT5H",
            "reopenClosedIncident": false
          },
          "createIncident": true
        },
        "eventGroupingSettings": {
          "aggregationKind": "AlertPerResult"
        },
        "query": "// Medium severity - Social and Public Exposure - Source Code Exposure on Public Repositories\nlet timeFrame = 5m;\nCyfirmaSPESourceCodeAlerts_CL\n| where severity == 'High' and TimeGenerated between (ago(timeFrame) .. now())\n| extend\n    Description=description,\n    FirstSeen=first_seen,\n    LastSeen=last_seen,\n    RiskScore=risk_score,\n    AlertUID=alert_uid,\n    UID=uid,\n    AssetType=asset_type,\n    AssetValue=signature,\n    Source=source,\n    Impact=impact,\n    Recommendation=recommendation,\n    ProviderName='CYFIRMA',\n    ProductName='DeCYFIR/DeTCT',\n    AlertTitle=Alert_title\n| project\n    TimeGenerated,\n    Description,\n    RiskScore,\n    FirstSeen,\n    LastSeen,\n    AlertUID,\n    UID,\n    AssetType,\n    AssetValue,\n    Impact,\n    ProductName,\n    ProviderName,\n    AlertTitle\n",
        "queryFrequency": "5m",
        "queryPeriod": "5m",
        "triggerOperator": "gt",
        "alertDetailsOverride": {
          "alertDisplayNameFormat": "CYFIRMA Medium Severity Alert - Source Code Exposure on Public Repositories - {{AlertTitle}} ",
          "alertDynamicProperties": [
            {
              "value": "ProductName",
              "alertProperty": "ProductName"
            },
            {
              "value": "ProviderName",
              "alertProperty": "ProviderName"
            }
          ],
          "alertDescriptionFormat": "{{Description}} "
        },
        "severity": "Medium",
        "triggerThreshold": 0,
        "tactics": [
          "ResourceDevelopment",
          "CredentialAccess",
          "Discovery"
        ],
        "description": "\"This rule triggers when CYFIRMA detects source code related to internal or enterprise domains exposed on public platforms like GitHub. \nSuch exposure may lead to intellectual property leakage or help adversaries understand internal systems, increasing the risk of targeted attacks.\"\n",
        "customDetails": {
          "AssetType": "AssetType",
          "RiskScore": "RiskScore",
          "TimeGenerated": "TimeGenerated",
          "LastSeen": "LastSeen",
          "AssetValue": "AssetValue",
          "FirstSeen": "FirstSeen",
          "AlertUID": "AlertUID",
          "UID": "UID",
          "Impact": "Impact",
          "Description": "Description"
        }
      }
    }
  ]
}
