{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "Parameters": {
    "Workspace": {
      "type": "string"
    }
  },
  "resources": [
    {
      "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/42e6f16a-7773-44cc-8668-8f648bd1aa4f')]",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/42e6f16a-7773-44cc-8668-8f648bd1aa4f')]",
      "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
      "kind": "Scheduled",
      "apiVersion": "2021-03-01-preview",
      "properties": {
        "severity": "High",
        "alertDetailsOverride": {
          "alertDynamicProperties": [
            {
              "value": "ProductName",
              "alertProperty": "ProductName"
            },
            {
              "value": "ProviderName",
              "alertProperty": "ProviderName"
            }
          ],
          "alertDescriptionFormat": "{{Description}} ",
          "alertDisplayNameFormat": "CYFIRMA High Severity Alert - Source Code Exposure on Public Repositories - {{AlertTitle}} "
        },
        "eventGroupingSettings": {
          "aggregationKind": "AlertPerResult"
        },
        "name": "CYFIRMA - Social and Public Exposure - Source Code Exposure on Public Repositories Rule",
        "description": "\"This rule triggers when CYFIRMA detects source code related to internal or enterprise domains exposed on public platforms like GitHub. \nSuch exposure may lead to intellectual property leakage or help adversaries understand internal systems, increasing the risk of targeted attacks.\"\n",
        "status": "Available",
        "queryFrequency": "5m",
        "customDetails": {
          "LastSeen": "LastSeen",
          "Impact": "Impact",
          "UID": "UID",
          "Description": "Description",
          "AlertUID": "AlertUID",
          "RiskScore": "RiskScore",
          "TimeGenerated": "TimeGenerated",
          "AssetType": "AssetType",
          "FirstSeen": "FirstSeen",
          "AssetValue": "AssetValue"
        },
        "query": "// High severity - Social and Public Exposure - Source Code Exposure on Public Repositories\nlet timeFrame = 5m;\nCyfirmaSPESourceCodeAlerts_CL\n| where severity == 'Critical' and TimeGenerated between (ago(timeFrame) .. now())\n| extend\n    Description=description,\n    FirstSeen=first_seen,\n    LastSeen=last_seen,\n    RiskScore=risk_score,\n    AlertUID=alert_uid,\n    UID=uid,\n    AssetType=asset_type,\n    AssetValue=signature,\n    Source=source,\n    Impact=impact,\n    Recommendation=recommendation,\n    ProviderName='CYFIRMA',\n    ProductName='DeCYFIR/DeTCT',\n    AlertTitle=Alert_title\n| project\n    TimeGenerated,\n    Description,\n    RiskScore,\n    FirstSeen,\n    LastSeen,\n    AlertUID,\n    UID,\n    AssetType,\n    AssetValue,\n    Impact,\n    ProductName,\n    ProviderName,\n    AlertTitle\n",
        "incidentConfiguration": {
          "groupingConfiguration": {
            "matchingMethod": "AllEntities",
            "enabled": false,
            "lookbackDuration": "PT5H",
            "reopenClosedIncident": false
          },
          "createIncident": true
        },
        "triggerOperator": "gt",
        "tactics": [
          "ResourceDevelopment",
          "CredentialAccess",
          "Discovery"
        ],
        "queryPeriod": "5m",
        "triggerThreshold": 0
      }
    }
  ]
}
