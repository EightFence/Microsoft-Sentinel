{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "Parameters": {
    "Workspace": {
      "type": "string"
    }
  },
  "resources": [
    {
      "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/17cce4fc-9b4c-4eef-a4c7-083b44545e6e')]",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/17cce4fc-9b4c-4eef-a4c7-083b44545e6e')]",
      "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
      "kind": "Scheduled",
      "apiVersion": "2021-03-01-preview",
      "properties": {
        "tactics": [
          "InitialAccess",
          "Exfiltration"
        ],
        "name": "CYFIRMA - Data Breach and Web Monitoring - Phishing Campaign Detection Rule",
        "eventGroupingSettings": {
          "aggregationKind": "AlertPerResult"
        },
        "query": "// High severity - Data Breach and Web Monitoring - Phishing Campaign Detection\nlet timeFrame = 5m;\nCyfirmaDBWMPhishingAlerts_CL\n| where severity == 'Critical' and TimeGenerated between (ago(timeFrame) .. now())\n| extend\n    Description=description,\n    FirstSeen=first_seen,\n    LastSeen=last_seen,\n    RiskScore=risk_score,\n    AlertUID=alert_uid,\n    UID=uid,\n    AssetType=asset_type,\n    AssetValue=signature,\n    Source=source,\n    Impact='',\n    Recommendation='',\n    ProviderName='CYFIRMA',\n    ProductName='DeCYFIR/DeTCT',\n    AlertTitle=Alert_title\n| project\n    TimeGenerated,\n    Description,\n    RiskScore,\n    FirstSeen,\n    LastSeen,\n    AlertUID,\n    UID,\n    AssetType,\n    AssetValue,\n    Source,\n    Impact,\n    Recommendation,\n    ProductName,\n    ProviderName,\n    AlertTitle\n",
        "triggerOperator": "gt",
        "alertDetailsOverride": {
          "alertDisplayNameFormat": "CYFIRMA - High Severity Alert:  Phishing Campaign Detection - {{AlertTitle}} ",
          "alertDescriptionFormat": "{{Description}} ",
          "alertDynamicProperties": [
            {
              "alertProperty": "ProductName",
              "value": "ProductName"
            },
            {
              "alertProperty": "ProviderName",
              "value": "ProviderName"
            }
          ]
        },
        "incidentConfiguration": {
          "createIncident": true,
          "groupingConfiguration": {
            "enabled": false,
            "lookbackDuration": "PT5H",
            "matchingMethod": "AllEntities",
            "reopenClosedIncident": false
          }
        },
        "customDetails": {
          "UID": "UID",
          "Impact": "Impact",
          "TimeGenerated": "TimeGenerated",
          "Description": "Description",
          "AlertUID": "AlertUID",
          "RiskScore": "RiskScore",
          "AssetType": "AssetType",
          "AssetValue": "AssetValue",
          "FirstSeen": "FirstSeen",
          "LastSeen": "LastSeen",
          "Source": "Source",
          "Recommendation": "Recommendation"
        },
        "triggerThreshold": 0,
        "description": "\"Detects phishing campaigns targeting enterprise domains, as identified through CYFIRMA's Data Breach and Dark Web Monitoring. \nThese alerts may include malicious URLs used for credential harvesting, domain impersonation, or social engineering. \nImmediate triage and takedown actions are recommended.\"\n",
        "queryFrequency": "5m",
        "status": "Available",
        "queryPeriod": "5m",
        "severity": "High"
      }
    }
  ]
}
