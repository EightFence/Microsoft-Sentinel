{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "Parameters": {
    "Workspace": {
      "type": "string"
    }
  },
  "resources": [
    {
      "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/d5f9a6fe-7fd2-488c-8690-0ca24fba43dc')]",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/d5f9a6fe-7fd2-488c-8690-0ca24fba43dc')]",
      "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
      "kind": "Scheduled",
      "apiVersion": "2021-03-01-preview",
      "properties": {
        "triggerOperator": "gt",
        "status": "Available",
        "severity": "Medium",
        "incidentConfiguration": {
          "groupingConfiguration": {
            "lookbackDuration": "PT5H",
            "matchingMethod": "AllEntities",
            "reopenClosedIncident": false,
            "enabled": false
          },
          "createIncident": true
        },
        "customDetails": {
          "Source": "Source",
          "LastSeen": "LastSeen",
          "RiskScore": "RiskScore",
          "FirstSeen": "FirstSeen",
          "Description": "Description",
          "AssetValue": "AssetValue",
          "Impact": "Impact",
          "AlertUID": "AlertUID",
          "Recommendation": "Recommendation",
          "ThreatActors": "ThreatActors",
          "TimeGenerated": "TimeGenerated",
          "UID": "UID",
          "AssetType": "AssetType"
        },
        "eventGroupingSettings": {
          "aggregationKind": "AlertPerResult"
        },
        "description": "\"This analytics rule detects high-severity ransomware threats targeting the organization, as reported by CYFIRMA's Dark Web and Data Breach Intelligence feeds. \nThe alert is generated when threat actors post, claim, or associate ransomware activity with corporate domains, brands, or subsidiaries, indicating a potential data breach, extortion attempt, or unauthorized access.\"\n",
        "alertDetailsOverride": {
          "alertDescriptionFormat": "{{Description}} ",
          "alertDynamicProperties": [
            {
              "alertProperty": "ProductName",
              "value": "ProductName"
            },
            {
              "alertProperty": "ProviderName",
              "value": "ProviderName"
            }
          ],
          "alertDisplayNameFormat": "CYFIRMA - Medium Severity Alert: Ransomware Exposure Detected - {{AlertTitle}} "
        },
        "triggerThreshold": 0,
        "queryPeriod": "5m",
        "tactics": [
          "InitialAccess",
          "Exfiltration"
        ],
        "query": "// Medium severity - Data Breach and Web Monitoring - Ransomware Exposure Detected\nlet timeFrame = 5m;\nCyfirmaDBWMRansomwareAlerts_CL\n| where severity == 'High' and TimeGenerated between (ago(timeFrame) .. now())\n| extend\n    Description=description,\n    FirstSeen=first_seen,\n    LastSeen=last_seen,\n    RiskScore=risk_score,\n    AlertUID=alert_uid,\n    UID=uid,\n    AssetType=asset_type,\n    AssetValue=signature,\n    Source=source,\n    Impact=impact,\n    Recommendation='',\n    ProviderName='CYFIRMA',\n    ProductName='DeCYFIR/DeTCT',\n    AlertTitle=Alert_title,\n    ThreatActors= threat_actors\n| project\n    TimeGenerated,\n    Description,\n    RiskScore,\n    FirstSeen,\n    LastSeen,\n    AlertUID,\n    UID,\n    AssetType,\n    AssetValue,\n    Source,\n    Impact,\n    Recommendation,\n    ProductName,\n    ProviderName,\n    AlertTitle,\n    ThreatActors\n",
        "queryFrequency": "5m",
        "name": "CYFIRMA - Data Breach and Web Monitoring - Ransomware Exposure Detected Rule"
      }
    }
  ]
}
