{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "Parameters": {
    "Workspace": {
      "type": "string"
    }
  },
  "resources": [
    {
      "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/00c7b41c-ddeb-4c49-acd7-2f7897e27fb4')]",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/00c7b41c-ddeb-4c49-acd7-2f7897e27fb4')]",
      "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
      "kind": "Scheduled",
      "apiVersion": "2021-03-01-preview",
      "properties": {
        "name": "CYFIRMA - Data Breach and Web Monitoring - Phishing Campaign Detection Rule",
        "queryFrequency": "5m",
        "triggerOperator": "gt",
        "status": "Available",
        "queryPeriod": "5m",
        "alertDetailsOverride": {
          "alertDescriptionFormat": "{{Description}} ",
          "alertDynamicProperties": [
            {
              "value": "ProductName",
              "alertProperty": "ProductName"
            },
            {
              "value": "ProviderName",
              "alertProperty": "ProviderName"
            }
          ],
          "alertDisplayNameFormat": "CYFIRMA - Medium Severity Alert:  Phishing Campaign Detection - {{AlertTitle}} "
        },
        "triggerThreshold": 0,
        "tactics": [
          "InitialAccess",
          "Exfiltration"
        ],
        "query": "// Medium severity - Data Breach and Web Monitoring - Phishing Campaign Detection\nlet timeFrame = 5m;\nCyfirmaDBWMPhishingAlerts_CL\n| where severity == 'High' and TimeGenerated between (ago(timeFrame) .. now())\n| extend\n    Description=description,\n    FirstSeen=first_seen,\n    LastSeen=last_seen,\n    RiskScore=risk_score,\n    AlertUID=alert_uid,\n    UID=uid,\n    AssetType=asset_type,\n    AssetValue=signature,\n    Source=source,\n    Impact='',\n    Recommendation='',\n    ProviderName='CYFIRMA',\n    ProductName='DeCYFIR/DeTCT',\n    AlertTitle=Alert_title\n| project\n    TimeGenerated,\n    Description,\n    RiskScore,\n    FirstSeen,\n    LastSeen,\n    AlertUID,\n    UID,\n    AssetType,\n    AssetValue,\n    Source,\n    Impact,\n    Recommendation,\n    ProductName,\n    ProviderName,\n    AlertTitle\n",
        "description": "\"Detects phishing campaigns targeting enterprise domains, as identified through CYFIRMA's Data Breach and Dark Web Monitoring. \nThese alerts may include malicious URLs used for credential harvesting, domain impersonation, or social engineering. \nImmediate triage and takedown actions are recommended.\"\n",
        "customDetails": {
          "TimeGenerated": "TimeGenerated",
          "Source": "Source",
          "Impact": "Impact",
          "AssetType": "AssetType",
          "AlertUID": "AlertUID",
          "FirstSeen": "FirstSeen",
          "LastSeen": "LastSeen",
          "RiskScore": "RiskScore",
          "AssetValue": "AssetValue",
          "UID": "UID",
          "Recommendation": "Recommendation",
          "Description": "Description"
        },
        "incidentConfiguration": {
          "createIncident": true,
          "groupingConfiguration": {
            "matchingMethod": "AllEntities",
            "lookbackDuration": "PT5H",
            "reopenClosedIncident": false,
            "enabled": false
          }
        },
        "eventGroupingSettings": {
          "aggregationKind": "AlertPerResult"
        },
        "severity": "Medium"
      }
    }
  ]
}
